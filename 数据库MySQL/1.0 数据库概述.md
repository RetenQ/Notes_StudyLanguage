# 数据库概述与安装    

## 概述

### What is SQL?
什么是SQL？SQL是结构化查询语言的缩写，用来访问和操作数据库系统。SQL语句既可以查询数据库中的数据，也可以添加、更新和删除数据库中的数据，还可以对数据库进行管理和维护操作。**不同的数据库，都支持SQL**，这样，我们通过学习SQL这一种语言，就可以操作各种不同的数据库.  

虽然SQL已经被ANSI组织定义为标准，不幸地是，各个不同的数据库对标准的SQL支持不太一致。并且，大部分数据库都在标准的SQL上做了扩展。也就是说，如果只使用标准SQL，理论上所有数据库都可以支持，但如果使用某个特定数据库的扩展SQL，换一个数据库就不能执行了.

现实情况是，如果我们只使用标准SQL的核心功能，那么所有数据库通常都可以执行。不常用的SQL功能，不同的数据库支持的程度都不一样。而各个数据库支持的各自扩展的功能，通常我们把它们称之为“方言”

### 数据库模型
数据库按照数据结构来组织、存储和管理数据，实际上其有三种模型    
**层次模型**      
层次模型就是以“上下级”的层次关系来组织数据的一种方式，层次模型的结构看起来像树: 
![](https://s2.loli.net/2022/03/07/a5Wz43IrA2QZtYN.png)     

**网状模型**    
网状模型把每个数据节点和其他很多节点都连接起来，它的数据结构像城市路网: 
![](https://s2.loli.net/2022/03/07/5aoe4gvdzZ9O21A.png) 

**关系模型**    
关系模型把数据看作一个二维表格，任何数据通过"行号+列号"唯一确定，它的模型像一个Excel表  
![](https://s2.loli.net/2022/03/07/G8RkBXZ1ThNWI5v.png)

随着时间推移，基于关系模型的关系数据库成为主流  

### 数据类型
对于一个关系表，除了定义名称，还需要定义数据类型：  
主要的支持的标准数据类型包括数值、字符串、时间等，如下所示: 
![](https://i.bmp.ovh/imgs/2022/03/9e117e6615a114df.png)    

> 通常来说，BIGINT能满足整数存储的需求，VARCHAR(N)能满足字符串存储的需求，这两种类型是使用最广泛的    

### 能力与写法简介  
总而言之，SQL有以下能力：
DDL：Data Definition Language   
DDL允许用户定义数据，也就是创建表、删除表、修改表结构这些操作   
通常,DDL由数据库管理员来执行    

DML：Data Manipulation Language
日常的操作，DML为用户提供添加、删除、更新数据的能力(增删改)，这些就是应用程序对数据库的日常操作 

DQL：Data Query Language
查！DQL允许用户查询数据，这是最频繁最常见的操作 

语法特点:
**SQL的关键字不区分大小写**，但对不同数据库、数据内容、名称，有的是区分的。甚至，有的在Linux上区分，而在win上不区分 

> 在下面的文章里，约定：SQL关键字总是大写，以示突出，表名和列名均使用小写。

## 安装MySQL    
和其他关系数据库有所不同的是，MySQL本身实际上只是一个SQL接口，它的内部还包含了多种数据引擎,常用的包括：
InnoDB：由Innobase Oy公司开发的一款支持事务的数据库引擎，2006年被Oracle收购；
MyISAM：MySQL早期集成的默认数据库引擎，不支持事务  

> MySQL接口和数据库引擎的关系就好比某某浏览器和浏览器引擎（IE引擎或Webkit引擎）的关系。对用户而言，切换浏览器引擎不影响浏览器界面，切换MySQL引擎不影响自己写的应用程序使用MySQL的接口。

在使用MySQL的时候，不同的表还可以使用不同的数据库引擎，若不知道该采用哪种引擎，就选择```InnoDB```   

### 历史渊源    
(这部分可跳过)  
MySQL是目前应用最广泛的开源关系数据库。MySQL最早是由瑞典的MySQL AB公司开发，该公司在2008年被SUN公司收购，紧接着，SUN公司在2009年被Oracle公司收购，所以MySQL最终就变成了Oracle旗下的产品 

因为MySQL一开始就是开源的，所以基于MySQL的开源版本，又衍生出了各种版本：    
**MariaDB**
由MySQL的创始人创建的一个开源分支版本，使用XtraDB引擎。 

**Aurora**  
由Amazon改进的一个MySQL版本，专门提供给在AWS托管MySQL用户，号称5倍的性能提升。      

**PolarDB** 
由Alibaba改进的一个MySQL版本，专门提供给在阿里云托管的MySQL用户，号称6倍的性能提升。    

MySQL官方版本又分了好几个版本： 
Community Edition：社区开源版本，免费； 
Standard Edition：标准版；  
Enterprise Edition：企业版；        
Cluster Carrier Grade Edition：集群版。 

## 安装MySQL:  
首先从MySQL官方网站下载最新的MySQL Community Server版本:    
这是无需安装版，可以但是要自己配置  
[MySQL官方网站](https://dev.mysql.com/downloads/mysql/) 

这是带安装器的版本
[MySQL带安装器](https://dev.mysql.com/downloads/windows/installer/8.0.html) 

可以参照对应的教程:
[MySQL解压版安装教程](https://blog.csdn.net/tyler880/article/details/109106093)
**请务必记住初始密码**  

[MySQL安装器版安装教程](https://www.runoob.com/w3cnote/windows10-mysql-installer.html)   

如果您有修改初始root密码等要求，可以参考
[初始化密码报错 ERROR 1820 (HY000):](https://blog.csdn.net/memory6364/article/details/82426052) 

[MySQL修改密码的3种方式](http://c.biancheng.net/view/7152.html)     

## 关系模型 
关系模型的本质是若干个存储数据的二维表，可以把它们看作很多个Excel表 
表的每一行(横向)被称为记录Record,记录是一个逻辑意义上的数据 
表的每一列(纵向)被称为字段Column,同一个表的每一行都有相同的若干字段 

字段定义了数据类型（整型、浮点型、字符串、日期等），以及是否允许为NULL  
> NULL就是“没有”，并不是0或者空串   

> 通常情况下，字段应该避免允许位NULL。这样可以简化查询条件，加快查询速度，也有利于应用程序在读取数据之后无需判断是否为NULL  

而与Excel不同的就在于，关系数据库的表间存在着“一对多”，“多对一”，“一对一”的关系。这样才能够按照应用程序的逻辑来组织和存储数据   

![](https://s2.loli.net/2022/03/08/sVycrH2TUMfoDZP.png) 

在关系数据库中，关系是通过**主键**和**外键**来维护的    

### 主键
对于关系表，有一个重要约束就是“任意两条记录都一定可以通过某个字段来唯一区分出它们”，这个能够唯一区分出不同记录的字段，就是**主键**  

对于主键，关键的一点就是：**记录一旦插入到表中，主键最好不要再修改**，因为主键是用来唯一定位记录的。    
> 所以，选取主键的一个基本原则是：不使用任何业务相关的字段作为主键  

作为主键最好是完全业务无关的字段，我们一般命名其为```id```,常见的，可以作为```id```的字段的类型有： 
1.自增整数类型：数据库会在插入数据时自动为每一条记录分配一个自增整数，这样我们就完全不用担心主键重复，也不用自己预先生成主键    

2.全局唯一GUID类型：使用一种全局唯一的字符串作为主键    
> 类似8f55d96b-8acc-4636-8cb8-76bf8abc2f57。GUID算法通过网卡MAC地址、时间戳和随机数保证任意计算机在任意时间生成的字符串都是不同的，大部分编程语言都内置了GUID算法，可以自己预算出主键   

而对大部分应用来说，自增类型的主键一般就可以满足需求了  

#### 联合主键
关系数据库还允许通过多个字段唯一标识记录，即“两个或更多的字段都设置为主键”，这种主键就是**联合主键**    
对于联合主键，允许一列有重复，只有不少所有主键列都重复即可  

![](https://s2.loli.net/2022/03/08/PLN8RGOwf7XAFtk.png)
如上图，如果我们把上述表的```id_num```和```id_type```两列作为联合主键，则上面三条记录都是允许的 

> 在没有必要的情况下，我们尽量不使用联合主键，因为它给关系表带来了复杂度的上升  

### 外键
在一张表中，通过某个字段可以将它与另外的表关联起来，这种列称为```外键```    
引用廖老师的例子，有    
![](https://s2.loli.net/2022/03/08/RsfnTwg4GcahkBN.png)

此时我们利用一个字段```class_id```来将两张表的关系进行连接  
![](https://s2.loli.net/2022/03/08/QKGOLh6S7PieVCn.png) 

这里的```class_id```,就是```student```表的外键  

外键的实现不少通过列名实现的，而是通过定义**外键约束**来实现的：    
```mySQL
ALTER TABLE students
ADD CONSTRAINT fk_class_id  
FOREIGN KEY (class_id)  
REFERENCES classes (id) ;
```

在上面的代码中，其中```fk_class_id```是外键约束的名称，它可以是自定义的/任意的 ， ```FOREIGN KEY (class_id)```则指定了这个外键将关联到```classes```表的```id```列(即是```classer```表的主键)    

通过定位外键约束，关系数据库可以保证无法插入无效的数据  
(即如果classes表不存在id=99的记录，students表就不能插入 class_id = 99的数据)    

> 由于外键约束会降低数据库的性能，大部分互联网应用程序为了追求速度，并不设置外键约束，而是仅靠应用程序自身来保证逻辑的正确性。这种情况下，class_id仅仅是一个普通的列，只是它起到了外键的作用而已。  

此外，要删除一个外键约束，也是通过```ALTER TABLE```来实现的 
``` mySQL
ALTER TABLE students 
DROP FOREIGN KEY fk_classs_id ; 
```
上述代码是删除了外键约束，而不是删除了外键这一列    

### 多对多
所谓“多对多”的关系，实际上是通过两个一对多的关系实现的。我们通过**一个中间表**，来关联两个一对多的关系，从而形成了多对多关系    

比如我们分别有
![](https://s2.loli.net/2022/03/08/9bE8wNykQdtVAIl.png)

在通过一个```teacher_class```表来关联   
![](https://s2.loli.net/2022/03/08/jCRxh4fTr6mpcWL.png) 

通过中间表teacher_class可知teachers到classes的关系，我们可以知道：  
id=1的张老师对应id=1,2的一班和二班  
id=2的王老师对应id=1,2的一班和二班  
id=3的李老师对应id=1的一班  
id=4的赵老师对应id=2的二班  

同理，对于```classed```到```teachers```的关系，我们知道:    
id=1的一班对应id=1,2,3的张老师、王老师和李老师  
id=2的二班对应id=1,2,4的张老师、王老师和赵老师  

### 一对一
一对一的关系是指，一个表的记录对应到另一个表的唯一一个记录  
如果业务允许的话，当然也可以把两个表化为一个表。比如原本有一个表```contacts```，它和```students```一对一，记录学生联系方式  
如果可以的话，我们当然能为```students```表增加一个额外的```mobile```列，来记录其联系方式    

但是某个学生没有手机号，那么，contacts表就不存在对应的记录，或者说，一对一关系准确地说，是contacts表一对一对应students表    

> 还有一些应用会把一个大表拆成两个一对一的表，目的是把经常读取和不经常读取的字段分开，以获得更高的性能。例如，把一个大的用户表分拆为用户基本信息表user_info和用户详细信息表user_profiles，大部分时候，只需要查询user_info表，并不需要查询user_profiles表，这样就提高了查询速度

### 索引
在查找记录的时候，想要获得非常快的速度，就需要使用索引  

**索引**是关系数据库中，对某一列或多个列的值进行预排序的数据结构。通过使用索引可以让数据库系统不必扫描整个表，而是直接定位到符合条件的记录，这样就大大加快了查询速度    

无论是否创建索引，对于用户和应用程序而言，他们在使用关系数据库的时候不会有任何区别。
当我们在数据库中查询的时候，如果有相应的索引可用，数据库系统就会自动使用索引来提高查询效率。如果没有索引，查询也可以正常执行，只是速度会变慢。  

比如说，对于下面这张表  
![](https://s2.loli.net/2022/03/08/qrulndQTDyoWBGF.png) 
我们可能会经常对```score```进行查询，因此可以对```score```创建一个索引如下: 
```mySQL
ALTER TABLE students 
ADD INDEX idx_score (score) ;
``` 
这里的```ADD INDEX idx_score (score)```就创建了一个名称为```idx_score```的，使用列```score```的索引。这里的索引名称是任意的，索引如果有很多列，则可以在括号里依次写上，如： 
```mySQL
ALTER TABLE students
ADD INDEX idx_name_score (name, score);
``` 

> 索引的效率取决于索引列的值是否散列，即该列的值如果越互不相同，那么索引效率越高。反过来，如果记录的列存在大量相同的值，例如gender列，大约一半的记录值是M，另一半是F，因此，对该列创建索引就没有意义。

> 可以对一张表创建多个索引。索引的优点是提高了查询效率，缺点是在插入、更新和删除记录时，需要同时修改索引，因此，索引越多，插入、更新和删除记录的速度就越慢。

而对于主键，关系数据库会**自动*8为其创建主键索引。使用主键索引是效率最高的，因为主键会保证绝对唯一  

#### 唯一索引
在设计关系数据表的时候，看上去唯一的列(例如身份证号、邮箱地址等),他们虽然不宜作为主键，但是又具有唯一性约束(比如不能出现两条记录存储了同一个身份证号码)，这个时候就可以给该列添加一个唯一索引。

比如我们假设```students```表的```name```不能重复：  
```mySQL
ALTER TABLE students
ADD UNIQUE INDEX uni_name (name) ; 
```
通过```UNIQUE```关键字，我们添加了一个唯一索引  
当然，也可以只对某一列添加一个唯一约束而不创建唯一索引：    
```mySQL    
ALTER TABLE students 
ADD CONSTRAINT uni_name UNIQUE (name) ;
```
这种情况，```name```没有索引，但仍然具有唯一性保证  